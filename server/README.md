# Театральная система бронирования билетов

## Описание
API для системы бронирования театральных билетов, разработанное с использованием Django REST Framework. Система позволяет просматривать театры, жанры, спектакли, проверять доступность мест и осуществлять бронирование.

## Установка и запуск

1. Клонируйте репозиторий
2. Создайте виртуальное окружение:
```bash
python -m venv .venv
source .venv/bin/activate  # для Linux/Mac
.venv\Scripts\activate     # для Windows
```
3. Установите зависимости:
```bash
pip install -r requirements.txt
```
4. Примените миграции:
```bash
python manage.py migrate
```
5. Запустите сервер:
```bash
python manage.py runserver
```

## API Endpoints

### Театры

#### Получение списка театров
- **URL**: `/api/theatres/`
- **Метод**: `GET`
- **Описание**: Возвращает список всех театров
- **Ответ**: 
```json
[
    {
        "id": 1,
        "name": "Название театра",
        "address": "Адрес театра",
        "capacity": "1000"
    }
]
```

### Жанры

#### Получение списка жанров
- **URL**: `/api/genres/`
- **Метод**: `GET`
- **Описание**: Возвращает список всех жанров
- **Ответ**: 
```json
[
    {
        "id": 1,
        "name": "Название жанра"
    }
]
```

### Сеансы (Спектакли)

#### Получение списка сеансов
- **URL**: `/api/sessions/`
- **Метод**: `GET`
- **Описание**: Возвращает список всех доступных сеансов
- **Ответ**: 
```json
[
    {
        "id": 1,
        "title": "Название спектакля",
        "picture": "URL изображения",
        "theatre": 1,
        "genre": 1,
        "description": "Описание спектакля",
        "date_time": "2024-04-22T19:00:00Z",
        "duration": "02:30:00",
        "price": "1500.00"
    },
    {
        "id": 2,
        "title": "Название спектакля",
        "picture": "URL изображения",
        "theatre": 1,
        "genre": 1,
        "description": "Описание спектакля",
        "date_time": "2024-04-22T19:00:00Z",
        "duration": "02:30:00",
        "price": "7500.00"
    }
]
```

#### Получение информации о конкретном сеансе
- **URL**: `/api/sessions/<id>/`
- **Метод**: `GET`
- **Описание**: Возвращает детальную информацию о конкретном сеансе
- **Параметры**: 
  - `id` - идентификатор сеанса
- **Ответ**: 
```json
{
    "id": 1,
    "title": "Название спектакля",
    "picture": "URL изображения",
    "theatre": 1,
    "genre": 1,
    "description": "Описание спектакля",
    "date_time": "2024-04-22T19:00:00Z",
    "duration": "02:30:00",
    "price": "1500.00"
}
```

### Места

#### Проверка доступности мест
- **URL**: `/api/sessions/<session_id>/seats/`
- **Метод**: `GET`
- **Описание**: Возвращает информацию о доступности мест для конкретного сеанса
- **Параметры**: 
  - `session_id` - идентификатор сеанса
- **Ответ**: 
```json
[
    {
        "row": 1,
        "number": 1,
        "is_available": true
    },
    {
        "row": 1,
        "number": 2,
        "is_available": false
    }
]
```

### Бронирование

#### Создание бронирования
- **URL**: `/api/bookings/`
- **Метод**: `POST`
- **Описание**: Создает новое бронирование
- **Требует аутентификации**: Да
- **Тело запроса**: 
```json
{
    "session": 1,
    "seat": 1
}
```
- **Ответ**: 
```json
{
    "id": 1,
    "user": 1,
    "session": 1,
    "seat": 1,
    "booking_date": "2024-04-22T15:30:00Z",
    "is_paid": true
}
```

#### Получение бронирований пользователя
- **URL**: `/api/user/bookings/`
- **Метод**: `GET`
- **Описание**: Возвращает список всех бронирований текущего пользователя
- **Требует аутентификации**: Да
- **Ответ**: 
```json
[
    {
        "id": 1,
        "session": {
            "id": 1,
            "title": "Название спектакля",
            "date_time": "2024-04-22T19:00:00Z"
        },
        "seat": {
            "row": 1,
            "number": 1
        },
        "booking_date": "2024-04-22T15:30:00Z",
        "is_paid": true
    }
]
```

## Фильтрация и поиск

### Фильтры для списка сеансов
Эндпоинт `/api/sessions/` поддерживает следующие параметры фильтрации:

#### Фильтры по театру и жанру
- `theatre` - ID театра
- `genre` - ID жанра

#### Фильтры по цене
- `price_min` - минимальная цена
- `price_max` - максимальная цена
- `price` - точная цена

#### Фильтры по дате
- `date_range_after` - дата начала периода (YYYY-MM-DD)
- `date_range_before` - дата окончания периода (YYYY-MM-DD)
- `date_time` - точная дата и время

#### Поиск
- `search` - поиск по названию и описанию спектакля

#### Сортировка
- `ordering` - сортировка по полям:
  - `date_time` - по дате (по умолчанию)
  - `price` - по цене
  - `title` - по названию
  - `-date_time` - по дате в обратном порядке
  - `-price` - по цене в обратном порядке
  - `-title` - по названию в обратном порядке

### Примеры запросов с фильтрами

#### Фильтрация по театру и жанру
```
GET /api/sessions/?theatre=1&genre=2
```

#### Фильтрация по цене
```
GET /api/sessions/?price_min=1000&price_max=2000
```

#### Фильтрация по дате
```
GET /api/sessions/?date_range_after=2024-04-01&date_range_before=2024-04-30
```

#### Поиск по названию
```
GET /api/sessions/?search=Гамлет
```

#### Сортировка по цене
```
GET /api/sessions/?ordering=price
```

## Модели данных

### Theatre (Театр)
- `name` (CharField) - название театра
- `address` (CharField) - адрес театра
- `capacity` (CharField) - вместимость театра

### Genre (Жанр)
- `name` (CharField) - название жанра

### Session (Сеанс)
- `title` (CharField) - название спектакля
- `picture` (CharField) - URL изображения
- `theatre` (ForeignKey) - театр
- `genre` (ForeignKey) - жанр
- `description` (TextField) - описание спектакля
- `date_time` (DateTimeField) - дата и время проведения
- `duration` (DurationField) - продолжительность
- `price` (DecimalField) - цена билета

### Seat (Место)
- `theatre` (ForeignKey) - театр
- `row` (PositiveIntegerField) - ряд
- `number` (PositiveIntegerField) - номер места

### Booking (Бронирование)
- `user` (ForeignKey) - пользователь
- `session` (ForeignKey) - сеанс
- `seat` (ForeignKey) - место
- `booking_date` (DateTimeField) - дата бронирования
- `is_paid` (BooleanField) - статус оплаты

## Аутентификация и Регистрация

### Регистрация нового пользователя
- **URL**: `/api/auth/users/`
- **Метод**: `POST`
- **Описание**: Создает нового пользователя в системе
- **Тело запроса**: 
```json
{
    "username": "имя_пользователя",
    "password": "пароль"
}
```
- **Ответ**: 
```json
{
    "id": 1,
    "username": "имя_пользователя"
}
```

### Получение токена аутентификации
- **URL**: `/api/auth/token/login/`
- **Метод**: `POST`
- **Описание**: Получение токена для аутентификации
- **Тело запроса**: 
```json
{
    "username": "имя_пользователя",
    "password": "пароль"
}
```
- **Ответ**: 
```json
{
    "auth_token": "ваш_токен_аутентификации"
}
```

### Обновление токена
- **URL**: `/api/auth/token/refresh/`
- **Метод**: `POST`
- **Описание**: Обновление истекшего токена
- **Тело запроса**: 
```json
{
    "refresh": "ваш_refresh_токен"
}
```
- **Ответ**: 
```json
{
    "access": "новый_токен_аутентификации"
}
```

### Использование токена
Для доступа к защищенным эндпоинтам необходимо добавить заголовок `Authorization` в каждый запрос:
```
Authorization: Bearer ваш_токен_аутентификации
```

### Защищенные эндпоинты
Следующие эндпоинты требуют аутентификации:
- Создание бронирования (`POST /api/bookings/`)
- Просмотр бронирований пользователя (`GET /api/user/bookings/`)
